Context: https://github.com/Rahix/avr-hal/issues/40

> Add usb-device support to atmega32u4


* FIND OFFICIAL ARDUINO CODE

  Use their code as reference

  * Keyboard.cpp

    https://github.com/arduino-libraries/Keyboard/blob/master/src/Keyboard.cpp#L64

    ```
    Keyboard_::Keyboard_(void)
    {
            static HIDSubDescriptor node(_hidReportDescriptor, sizeof(_hidReportDescriptor));
            HID().AppendDescriptor(&node);
            _asciimap = KeyboardLayout_en_US;
    }
    ```

    seems like magic happens in the HID module

  * HID.h

    https://github.com/arduino/ArduinoCore-avr/blob/7c38f34da561266e1e5cf7769f0e61b0aa5dda39/libraries/HID/src/HID.h#L24

    between `HID.h` and `HID.cpp`, `PluggableUSB.h` looks like the only relevant
    `#include`

  * PluggableUSB.h

    https://github.com/arduino/ArduinoCore-avr/blob/master/cores/arduino/PluggableUSB.h
    https://github.com/arduino/ArduinoCore-avr/blob/master/cores/arduino/PluggableUSB.cpp



    https://github.com/arduino/ArduinoCore-avr/blob/master/cores/arduino/USBAPI.h



  ###

  https://github.com/arduino/ArduinoCore-avr/blob/7c38f34da561266e1e5cf7769f0e61b0aa5dda39/cores/arduino/main.cpp#L40

  * `main` calls `USBDevice.attach();`. That must be the entry point!

  `USBDevice.attach()
  https://github.com/arduino/ArduinoCore-avr/blob/7c38f34da561266e1e5cf7769f0e61b0aa5dda39/cores/arduino/USBCore.cpp#L825



* misc usb-device examples: https://github.com/rust-embedded-community/usb-device?tab=readme-ov-file#hardware-driver-crates

  A lot of the examples have unsafe code... These two don't:

  * https://github.com/py32-rs/py32-hal/blob/main/examples/usbd-f072/src/bin/hid.rs

  * https://github.com/py32-rs/py32-hal/blob/main/examples/usbd-f072/src/bin/serial.rs


* upstream:

  * original PR:
    https://github.com/Rahix/avr-hal/pull/572/files

  * atmega-usbd: https://github.com/agausmann/atmega-usbd

    https://github.com/agausmann/atmega-usbd/blob/master/src/lib.rs
    https://github.com/agausmann/atmega-usbd/blob/master/examples/arduino_keyboard.rs
