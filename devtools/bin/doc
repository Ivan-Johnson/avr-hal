#!/usr/bin/env bash
#########
# SETUP #
#########
set -euo pipefail

if [[ -v DEBUG ]]; then
	set -x
fi

# `cd` to the directory that this script is in, i.e. `devtools/bin/`
cd "$(dirname "$0")"

# `cd` back to the root of the repo
cd "../.."

REPO_ROOT="$(pwd)"


###################
# PARSE ARGUMENTS #
###################

basename="$(basename "$0")"

if [ "$#" -ge 1 ] && ( [ "$1" = "-h" ] || [ "$1" = "--help" ] ); then
	cat <<-EOF
		This script is use to foo.

		You need bar before you can use this script. Then baz, abc, and xyz.
	EOF

	# We use printf to print example commands in two columns, while making sure that the columns are aligned
	fstring="\t%-40s %s\n"
	printf "$fstring" "[EXAMPLE COMMAND]" "[DESCRIPTION]"
	printf "$fstring" "$basename" 'This invokes the default behavior, of doing abc, and then xyz.'
	#printf "$fstring" "$basename --foo" "The foo option is used to ..."
	exit 0
fi

if [ "$#" -ne 0 ]; then
	echo "This script takes no arguments"
	echo
	"$0" --help
	exit 1
fi

##############
# MAIN LOGIC #
##############

echo "################################################################"
echo "# atmega-hal"
pushd mcu/atmega-hal &> /dev/null
cargo doc --features atmega328p
popd &> /dev/null

echo "################################################################"
echo "# mcu/attiny-hal"
pushd mcu/attiny-hal &> /dev/null
cargo doc --features attiny85
popd &> /dev/null

echo "################################################################"
echo "# arduino-hal"
pushd arduino-hal &> /dev/null
cargo doc --features arduino-uno
popd &> /dev/null
